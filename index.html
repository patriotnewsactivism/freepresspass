<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Constitutional Press Pass</title>
  <link rel="stylesheet" href="styles.css">
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <header>
    <h1>Constitutional Press</h1>
  </header>
  
  <main>
    <div class="container">
      <div class="form-section">
        <h2>Generate Your Press Pass</h2>
        <form id="passForm" netlify>
          <input type="hidden" name="form-name" value="press-passes" />
          <div class="form-group">
            <label for="name">Full Name:</label>
            <input type="text" id="name" name="name" required>
          </div>
          
          <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="Investigative Journalist" required>
          </div>
          
          <div class="form-group">
            <label for="photo">Add Photo:</label>
            <input type="file" id="photo" name="photo" accept="image/*">
          </div>
          
          <button type="button" id="generate">Generate Press Pass</button>
          <button type="button" id="checkout">Get Laminated Pass ($10-15)</button>
        </form>
      </div>
      
      <div class="preview-section">
        <h2>Press Pass Preview</h2>
        <canvas id="passCanvas" width="400" height="600"></canvas>
        <div class="actions">
          <button id="download">Download</button>
          <button id="openImage">Open Image</button>
        </div>
      </div>
    </div>
    
    <div class="exposure-reports">
      <h2>Exposure Reports</h2>
      <iframe id="reportsFrame" src="https://www.youtube.com/embed?listType=playlist&list=PL8f30603cbb" width="100%" height="400" frameborder="0" allowfullscreen></iframe>
    </div>
  </main>
  
  <footer>
    <p>This journalist is recognized under the protections of the First Amendment of the U.S. Constitution. Any interference will be a violation of federal law.</p>
    <p>Do not hinder, exclude, or block the view of this journalist in the exercise of court-recognized First Amendment rights.</p>
  </footer>
  
  <script>
    // Canvas rendering
    const canvas = document.getElementById('passCanvas');
    const ctx = canvas.getContext('2d');
    
    // Generate a random pass ID
    function genPassId() {
      return 'pass-' + Math.random().toString(36).substring(2, 10).toUpperCase();
    }
    
    // Get brand name
    function brandName() {
      return 'CONSTITUTIONAL PRESS ASSOCIATION';
    }
    
    // Draw the press pass on canvas
    function drawPass(name, title) {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Background
      ctx.fillStyle = '#f8f9fa';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw border
      ctx.strokeStyle = '#2c3e50';
      ctx.lineWidth = 3;
      ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
      
      // Header
      const headerHeight = 80;
      ctx.fillStyle = '#dc143c';
      ctx.fillRect(0, 0, canvas.width, headerHeight);
      
      // Header text
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 24px "Helvetica", Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('PRESS PASS', canvas.width/2, 35);
      
      // Photo placeholder (larger)
      ctx.fillStyle = '#e9ecef';
      ctx.fillRect(20, 100, canvas.width - 40, 250);
      
      ctx.fillStyle = '#2c3e50';
      ctx.font = '18px "Helvetica", Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('PHOTO AREA', canvas.width/2, 225);
      
      // Name and title
      const orgY = 370;
      ctx.textAlign = 'center';
      ctx.fillStyle = '#2c3e50';
      ctx.font = 'bold 32px "Helvetica", Arial, sans-serif';
      ctx.fillText(name || 'YOUR NAME HERE', canvas.width/2, orgY);
      
      const startRightY = orgY + 70;
      ctx.textAlign = 'center';
      ctx.fillStyle = '#2c3e50';
      ctx.font = 'bold 32px "Helvetica", Arial, sans-serif';
      ctx.fillText(brandName(), canvas.width/2, startRightY);
      ctx.font = 'bold 24px "Helvetica", Arial, sans-serif';
      ctx.fillText(title, canvas.width/2, startRightY + 35);
      
      // Bottom metadata
      const id = genPassId();
      ctx.font = 'bold 18px "Helvetica", Arial, sans-serif';
      ctx.fillText('FULL COURT PRESS MEDIA', canvas.width/2, startRightY + 80);
      ctx.font = '14px "Helvetica", Arial, sans-serif';
      ctx.fillText(`ID: ${id}`, canvas.width/2, startRightY + 105);
      ctx.font = 'bold 12px "Helvetica", Arial, sans-serif';
      ctx.fillText('ISSUED BY', canvas.width/2, startRightY + 130);
      ctx.font = 'bold 12px "Helvetica", Arial, sans-serif';
      ctx.fillText('CONSTITUTIONAL PRESS ASSOCIATION', canvas.width/2, startRightY + 145);
      
      const exp = new Date(new Date().getFullYear() + 2, 11, 31);
      ctx.fillStyle = '#dc143c';
      ctx.font = 'bold 14px "Helvetica", Arial, sans-serif';
      ctx.fillText(`VALID THROUGH DEC 31, ${exp.getFullYear()}`, canvas.width/2, startRightY + 170);
      
      // Legal lines
      ctx.fillStyle = '#1a252f';
      ctx.font = 'bold 12px "Helvetica", Arial, sans-serif';
      const legalY = startRightY + 200;
      const lines = [
        'THIS JOURNALIST IS RECOGNIZED UNDER THE PROTECTIONS',
        'OF THE FIRST AMENDMENT OF THE U.S. CONSTITUTION.',
        'ANY INTERFERENCE WILL BE A VIOLATION OF FEDERAL LAW.'
      ];
      lines.forEach((t, i) => ctx.fillText(t, canvas.width/2, legalY + i*17));
      
      ctx.fillStyle = '#2c3e50';
      ctx.font = 'bold 11px "Helvetica", Arial, sans-serif';
      const addY = legalY + 70;
      const notes = [
        'Do not hinder, exclude, or block the view of this journalist',
        'in the exercise of courtâ€‘recognized First Amendment rights.'
      ];
      notes.forEach((t, i) => ctx.fillText(t, canvas.width/2, addY + i*16));
      
      return id;
    }
    
    // Generate pass when button is clicked
    document.getElementById('generate').addEventListener('click', () => {
      const name = document.getElementById('name').value;
      const title = document.getElementById('title').value;
      drawPass(name, title);
      
      // Track the issued pass
      const formData = new FormData();
      formData.append('form-name', 'press-passes');
      formData.append('name', name);
      formData.append('title', title);
      formData.append('issued-at', new Date().toISOString());
      
      fetch('/', {
        method: 'POST',
        body: formData
      });
    });
    
    // Download functionality
    document.getElementById('download').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'press-pass.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
    
    // Open image functionality (for mobile)
    document.getElementById('openImage').addEventListener('click', () => {
      const dataUrl = canvas.toDataURL('image/png');
      window.open(dataUrl, '_blank');
    });
    
    // Checkout functionality
    document.getElementById('checkout').addEventListener('click', async () => {
      const name = (document.getElementById('name').value || '').trim();
      const id = 'pass-' + (Date.now().toString(36).toUpperCase());
      try {
        const res = await fetch('/.netlify/functions/create-checkout-session', {
          method: 'POST',
          body: JSON.stringify({ quantity: 1, passId: id, name })
        });
        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          alert(data.error || 'Unable to start checkout.');
        }
      } catch (e) {
        alert('Checkout failed.');
      }
    });
    
    // Initialize with a sample pass
    drawPass('YOUR NAME HERE', 'Investigative Journalist');
  </script>
</body>
</html>